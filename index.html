<script>
  const words = ["ICT", "BtoB", "BtoC", "CtoC", "SOHO"];
  let selectedChip = null;
  let startTime;
  let timerInterval;

  function renderBank() {
    const bank = document.getElementById('word-bank');
    bank.innerHTML = '';
    [...words].sort(() => Math.random() - 0.5).forEach(word => {
      const chip = document.createElement('div');
      chip.className = 'word-chip';
      chip.textContent = word;
      chip.onclick = () => {
        if (chip.classList.contains('used')) return;
        if (selectedChip) selectedChip.classList.remove('selected-chip');
        selectedChip = chip;
        chip.classList.add('selected-chip');
      };
      bank.appendChild(chip);
    });
  }

  // チャレンジ開始ボタンの処理
  document.getElementById('start-btn').onclick = () => {
    document.querySelectorAll('.blank').forEach(b => { 
      b.textContent = ''; 
      b.dataset.val = ''; 
      b.classList.remove('correct'); 
    });
    renderBank();
    document.getElementById('check-btn').disabled = false;
    document.getElementById('start-btn').disabled = true;
    startTime = Date.now();
    timerInterval = setInterval(() => {
      const diff = Math.floor((Date.now() - startTime) / 1000);
      document.getElementById('timer').textContent = `経過時間：${diff}秒`;
    }, 1000);
  };

  // 穴埋めをクリックした時の処理
  document.querySelectorAll('.blank').forEach(blank => {
    blank.onclick = () => {
      if (!startTime) return;
      if (selectedChip) {
        if (blank.dataset.val) {
          const oldChip = Array.from(document.querySelectorAll('.word-chip')).find(c => c.textContent === blank.dataset.val);
          if (oldChip) oldChip.classList.remove('used');
        }
        blank.textContent = selectedChip.textContent;
        blank.dataset.val = selectedChip.textContent;
        selectedChip.classList.add('used');
        selectedChip.classList.remove('selected-chip');
        selectedChip = null;
      }
    };
  });

  // 判定ボタンの処理（ここが抜けていたためエラーで動かなかった可能性があります）
  document.getElementById('check-btn').onclick = () => {
    let correctCount = 0;
    const blanks = document.querySelectorAll('.blank');
    blanks.forEach(b => {
      if (b.dataset.val === b.dataset.id) {
        b.classList.add('correct');
        correctCount++;
      }
    });

    if (correctCount === blanks.length) {
      clearInterval(timerInterval);
      alert("全問正解です！おめでとうございます！");
      document.getElementById('next-btn').style.display = "inline-block";
    } else {
      alert("まだ間違いがあるか、埋まっていない箇所があります。");
    }
  };
</script>
