<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>çˆ†é€Ÿè‹±æ–‡æ³•ï½œEA10 ä¸‰å˜ç¾ã®s</title>
    <style>
        body { font-family: "Meiryo", sans-serif; background:#f4f6fb; margin:0; padding-bottom: 250px; }
        header { background:#1e3a8a; color:white; padding:15px; text-align:center; }
        .container { max-width:1200px; margin:auto; padding:16px; display: flex; gap: 20px; }
        .main-content { flex: 2.5; }
        .side-content { flex: 1; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); height: fit-content; position: sticky; top: 20px; }
        
        .step-nav { display: flex; gap: 5px; margin-bottom: 15px; }
        .step-btn { flex: 1; padding: 12px; border: none; background: #cbd5e1; cursor: pointer; font-weight: bold; border-radius: 5px; transition: 0.3s; }
        .step-btn.active { background: #1e3a8a; color: white; border-bottom: 4px solid #fb923c; }
        .step-btn.completed { background: #2563eb !important; color: white !important; }

        /* é‡è¦å˜èªãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— */
        .imp-word { color: #16a34a !important; font-weight: bold !important; text-decoration: underline; cursor: pointer; position: relative; display: inline-block; }
        .tooltip { visibility: hidden; width: 220px; background: #333; color: #fff; text-align: center; padding: 10px; border-radius: 8px; position: absolute; bottom: 130%; left: 50%; transform: translateX(-50%); z-index: 10000; font-size: 0.85rem; line-height: 1.4; opacity: 0; transition: 0.3s; pointer-events: auto; }
        .imp-word:hover .tooltip { visibility: visible; opacity: 1; }
        .add-btn { background: #fb923c; color: white; border: none; padding: 3px 8px; border-radius: 4px; cursor: pointer; font-size: 0.75rem; margin-top: 5px; pointer-events: auto; }

        .section { background:white; border-radius:10px; padding:25px; margin-bottom:20px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
        .rule-card { border-left: 5px solid #dc2626; background: #fff1f2; padding: 15px; margin: 10px 0; border-radius: 0 8px 8px 0; line-height: 1.8; font-size: 0.95rem; }
        .blue-card { border-left: 5px solid #2563eb; background: #eff6ff; padding: 15px; margin: 10px 0; border-radius: 0 8px 8px 0; line-height: 1.6; }
        .task-box { background: #f8fafc; border: 1px solid #e2e8f0; padding: 15px; border-radius: 10px; margin-top: 10px; line-height: 2.2; }
        
        .blank { display: inline-block; min-width: 95px; height: 26px; border-bottom: 2px solid #2ecc71; vertical-align: middle; text-align: center; color: #2563eb; font-weight: bold; cursor: pointer; }
        .is-active { background: #f0fff4; border: 2px solid #2ecc71; border-radius: 4px; }
        .square { display: inline-block; min-width: 95px; height: 38px; border: 2px solid #2ecc71; border-radius: 4px; vertical-align: middle; margin: 4px; background: #fff; text-align: center; line-height: 38px; color: #2563eb; font-weight: bold; cursor: pointer; padding: 0 5px; }

        .voice-btn { background: #fb923c; color: white; border: none; padding: 4px 10px; border-radius: 50px; cursor: pointer; font-size: 0.8rem; margin-left: 8px; vertical-align: middle; }
        .fixed-pool { position: fixed; bottom: 0; left: 0; width: 100%; background: #eef2ff; border-top: 3px solid #2563eb; padding: 15px; z-index: 999; text-align: center; display: none; }
        .word-card { display: inline-block; background: white; border: 1px solid #c7d2fe; padding: 10px 18px; margin: 5px; border-radius: 8px; cursor: pointer; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .word-card.hidden { visibility: hidden; pointer-events: none; }
        .word-card.selected { background: #ffffaa; border-color: #fb923c; }

        .btn-start { background: #dc2626; color: white; padding: 15px; width: 100%; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1.2rem; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; font-size: 0.9rem; background: white; }
        th, td { border: 1px solid #000; padding: 10px; text-align: center; vertical-align: middle; }
        th { background: #f8fafc; font-weight: bold; }
        .ruby { font-size: 0.75rem; color: #2563eb; display: block; margin-top: 2px; }
        .hidden-ruby { visibility: hidden; }
        .example-intro { background: #fffbeb; border: 1px solid #fde68a; padding: 12px; border-radius: 8px; margin: 10px 0; font-weight: bold; }

        .q-item { border-bottom: 1px dashed #cbd5e1; padding: 15px 0; }
        .jp-text { display: block; color: #475569; font-size: 0.9rem; margin-bottom: 5px; }
        .hint-text { font-size: 0.8rem; color: #dc2626; font-weight: bold; display: block; margin-top: 5px; }
        .hidden-hint { display: none; }
        .fixed-mark { font-weight: bold; font-size: 1.2rem; margin-left: 2px; vertical-align: middle; }
        .word-list { list-style: none; padding: 0; }
        .word-list li { background: #f8fafc; margin-bottom: 5px; padding: 8px; border-radius: 5px; font-size: 0.9rem; border-left: 4px solid #16a34a; }
        .line-break { display: block; height: 10px; }
    </style>
</head>
<body onload="init()">

<header><h1>âš¡ï¸ çˆ†é€Ÿè‹±æ–‡æ³•ï¼šEA10 ä¸‰å˜ç¾ã®s</h1></header>

<div class="container">
    <div class="main-content">
        <div class="step-nav" id="step-nav-bar">
            <button class="step-btn active" id="btn-info" onclick="changeStep('info')">1.èª¬æ˜ã¨ç¢ºèªå•é¡Œ</button>
            <button class="step-btn" id="btn-ex" onclick="changeStep('ex')">2.ä¾‹é¡Œæ¼”ç¿’</button>
            <button class="step-btn" id="btn-prac" onclick="changeStep('prac')">3.é¡é¡Œæ¼”ç¿’</button>
            <button class="step-btn" id="btn-test" onclick="changeStep('test')">4.ä¿®äº†ãƒ†ã‚¹ãƒˆ</button>
        </div>
        <div id="display-area"></div>
    </div>

    <div class="side-content">
        <div id="timer" style="font-size:3rem; text-align:center; color:red; font-weight:bold;">00:00</div>
        <button id="start-btn" class="btn-start" onclick="startChallenge()">ãƒãƒ£ãƒ¬ãƒ³ã‚¸é–‹å§‹ï¼</button>
        <h3 style="border-bottom: 2px solid #dc2626; margin-top:20px; font-size:1.1rem;">â± ã‚¿ã‚¤ãƒ ãƒ¬ã‚³ãƒ¼ãƒ‰</h3>
        <ul id="record-list" style="list-style:none; padding:0;">
            <li style="background: #f1f5f9; padding:8px; border-radius:5px; display:flex; justify-content:space-between;"><span>ãƒ¬ã‚³ãƒ¼ãƒ‰</span><span id="rec-0">--:--</span></li>
        </ul>
        <h3 style="border-bottom: 2px solid #16a34a; margin-top:30px; font-size:1.1rem;">ğŸ“— ãƒã‚¤å˜èªå¸³</h3>
        <ul id="my-vocab" class="word-list"></ul>
    </div>
</div>

<div id="pool-fixed" class="fixed-pool"><div id="word-pool"></div></div>

<script>
const DICT = {
    "plays": "ãƒ—ãƒ¬ã‚¤ã‚º (å‹•)ï½ã‚’ã™ã‚‹ï¼ˆä¸‰å˜ç¾ï¼‰",
    "goes": "ã‚´ã‚¦ã‚º (å‹•)è¡Œãï¼ˆä¸‰å˜ç¾ï¼‰",
    "studies": "ã‚¹ã‚¿ãƒ‡ã‚£ãƒ¼ã‚º (å‹•)å‹‰å¼·ã™ã‚‹ï¼ˆä¸‰å˜ç¾ï¼‰",
    "has": "ãƒã‚º (å‹•)æŒã£ã¦ã„ã‚‹ï¼ˆä¸‰å˜ç¾ï¼‰",
    "doesn't": "ãƒ€ã‚ºãƒ³ãƒˆ (åŠ©)ï½ã—ãªã„",
    "does": "ãƒ€ã‚º (åŠ©)ï½ã™ã‚‹ / ï½ã§ã™ã‹",
    "math": "ãƒã‚¹ (å)æ•°å­¦",
    "computer": "ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ (å)ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿",
    "japanese": "ã‚¸ãƒ£ãƒ‘ãƒ‹ãƒ¼ã‚º (å)æ—¥æœ¬èªã€æ—¥æœ¬äºº (å½¢)æ—¥æœ¬ã®",
    "every": "ã‚¨ãƒ´ãƒª (å½¢)æ¯ï½ã€ã™ã¹ã¦ã®",
    "day": "ãƒ‡ã‚¤ (å)æ—¥ã€ï¼‘æ—¥",
    "soccer": "ã‚µãƒƒã‚«ãƒ¼ (å)ã‚µãƒƒã‚«ãƒ¼",
    "tennis": "ãƒ†ãƒ‹ã‚¹ (å)ãƒ†ãƒ‹ã‚¹",
    "breakfast": "ãƒ–ãƒ¬ãƒƒã‚¯ãƒ•ã‚¡ã‚¹ãƒˆ (å)æœé£Ÿ",
    "brother": "ãƒ–ãƒ©ã‚¶ãƒ¼ (å)å…„å¼Ÿã€å…„ã€å¼Ÿ",
    "guitar": "ã‚®ã‚¿ãƒ¼ (å)ã‚®ã‚¿ãƒ¼",
    "practices": "ãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚£ã‚º (å‹•)ç·´ç¿’ã™ã‚‹ï¼ˆä¸‰å˜ç¾ï¼‰",
    "sister": "ã‚¹ã‚£ã‚¹ã‚¿ãƒ¼ (å)å§‰å¦¹ã€å§‰ã€å¦¹",
    "french": "ãƒ•ãƒ¬ãƒ³ãƒ (å)ãƒ•ãƒ©ãƒ³ã‚¹èª",
    "after": "ã‚¢ãƒ•ã‚¿ãƒ¼ (å‰)ï½ã®ã‚ã¨ã«",
    "school": "ã‚¹ã‚¯ãƒ¼ãƒ« (å)å­¦æ ¡",
    "drink": "ãƒ‰ãƒªãƒ³ã‚¯ (å‹•)é£²ã‚€",
    "library": "ãƒ©ã‚¤ãƒ–ãƒ©ãƒª (å)å›³æ›¸é¤¨",
    "hard": "ãƒãƒ¼ãƒ‰ (å‰¯)ä¸€ç”Ÿæ‡¸å‘½ã«",
    "bathtub": "ãƒã‚¹ã‚¿ãƒ– (å)æµ´æ§½ã€ãŠé¢¨å‘‚",
    "wash": "ã‚¦ã‚©ãƒƒã‚·ãƒ¥ (å‹•)æ´—ã†",
    "clean": "ã‚¯ãƒªãƒ¼ãƒ³ (å‹•)æƒé™¤ã™ã‚‹",
    "sunday": "ã‚µãƒ³ãƒ‡ã‚¤ (å)æ—¥æ›œæ—¥",
    "park": "ãƒ‘ãƒ¼ã‚¯ (å)å…¬åœ’"
};

const MASTER_DATA = {
    ex: [
        { jp: "å½¼ã¯æ¯æ—¥ãƒ†ãƒ‹ã‚¹ã‚’ã—ã¾ã™ã€‚", en: ["He", "plays", "tennis", "every", "day"], mark: ".", type: "a" },
        { jp: "å½¼å¥³ã¯æœé£Ÿã‚’é£Ÿã¹ã¾ã›ã‚“ã€‚", en: ["She", "doesn't", "eat", "breakfast"], mark: ".", type: "a" },
        { jp: "ã‚ãªãŸã®å¼Ÿã¯è‹±èªã‚’å‹‰å¼·ã—ã¾ã™ã‹ï¼Ÿ", en: ["Does", "your", "brother", "study", "English"], mark: "?", type: "q" },
        { jp: "ã‚±ãƒ³ã¯æ–°ã—ã„è»Šã‚’æŒã£ã¦ã„ã¾ã™ã€‚", en: ["Ken", "has", "a", "new", "car"], mark: ".", type: "a" },
        { jp: "ç§ã®æ¯ã¯æ¯æ—¥å­¦æ ¡ã¸è¡Œãã¾ã™ã€‚", en: ["My", "mother", "goes", "to", "school", "every", "day"], mark: ".", type: "a" },
        { jp: "å½¼ã¯ã‚®ã‚¿ãƒ¼ã‚’å¼¾ãã¾ã™ã‹ï¼Ÿ â€• ã¯ã„ã€ã—ã¾ã™ã€‚", en: ["Does", "he", "play", "the", "guitar", "?", "Yes,", "he", "does"], mark: ".", type: "q" }
    ],
    prac: [
        { jp: "å½¼å¥³ã¯ãƒ•ãƒ©ãƒ³ã‚¹èªã‚’è©±ã—ã¾ã™ã€‚", en: ["She", "speaks", "French"], mark: ".", type: "a" },
        { jp: "ãƒˆãƒ ã¯é­šãŒå¥½ãã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚", en: ["Tom", "doesn't", "like", "fish"], mark: ".", type: "a" },
        { jp: "ãã®çŒ«ã¯ãƒŸãƒ«ã‚¯ã‚’é£²ã¿ã¾ã™ã‹ï¼Ÿ", en: ["Does", "the", "cat", "drink", "milk"], mark: "?", type: "q" },
        { jp: "ç§ã®çˆ¶ã¯æ¯æ—¥ãƒ”ã‚¢ãƒã‚’ç·´ç¿’ã—ã¾ã™ã€‚", en: ["My", "father", "practices", "the", "piano", "every", "day"], mark: ".", type: "a" },
        { jp: "ãƒ¡ã‚¢ãƒªãƒ¼ã¯æ”¾èª²å¾Œå‹‰å¼·ã—ã¾ã™ã‹ï¼Ÿ", en: ["Does", "Mary", "study", "after", "school"], mark: "?", type: "q" },
        { jp: "ã‚ãªãŸã®å¦¹ã¯ãƒ”ã‚¢ãƒã‚’æŒã£ã¦ã„ã¾ã™ã‹ï¼Ÿ â€• ã„ã„ãˆã€æŒã£ã¦ã„ã¾ã›ã‚“ã€‚", en: ["Does", "your", "sister", "have", "a", "piano", "?", "No,", "she", "doesn't"], mark: ".", type: "q" }
    ],
    test: [
        { jp: "å½¼ã¯æ¯æ—¥ã“ã®å…¬åœ’ã§èµ°ã‚Šã¾ã™ã€‚", en: ["He", "runs", "in", "this", "park", "every", "day"], mark: ".", type: "a" },
        { jp: "å½¼å¥³ã¯è‡ªåˆ†ã®éƒ¨å±‹ã‚’æƒé™¤ã—ã¾ã›ã‚“ã€‚", en: ["She", "doesn't", "clean", "her", "room"], mark: ".", type: "a" },
        { jp: "ã‚±ãƒ³ã¯æ¯é€±æ—¥æ›œæ—¥ã«å›³æ›¸é¤¨ã«è¡Œãã¾ã™ã‹ï¼Ÿ", en: ["Does", "Ken", "go", "to", "the", "library", "every", "Sunday"], mark: "?", type: "q" },
        { jp: "ç§ã®å…„ã¯æ•°å­¦ã‚’ä¸€ç”Ÿæ‡¸å‘½å‹‰å¼·ã—ã¾ã™ã€‚", en: ["My", "brother", "studies", "math", "hard"], mark: ".", type: "a" },
        { jp: "å½¼ã¯æ¯æ—¥ãŠé¢¨å‘‚ã‚’æ´—ã„ã¾ã™ã‹ï¼Ÿ", en: ["Does", "he", "wash", "the", "bathtub", "every", "day"], mark: "?", type: "q" },
        { jp: "ãƒˆãƒ ã¯ãƒ†ãƒ‹ã‚¹ã‚’ã—ã¾ã™ã‹ï¼Ÿ â€• ã„ã„ãˆã€ã—ã¾ã›ã‚“ã€‚", en: ["Does", "Tom", "play", "tennis", "?", "No,", "he", "doesn't"], mark: ".", type: "q" }
    ]
};

let currentMode = 'info', isChallenging = false, selectedWord = null, selectedId = null, startTime, timerInterval;

function init() { changeStep('info'); }

function wrapWord(word) {
    const pureWord = word.replace(',', '').replace('.', '').replace('?', '').toLowerCase();
    if (DICT[pureWord]) {
        return `<span class="imp-word">${word}<span class="tooltip">${DICT[pureWord]}<br><button class="add-btn" onclick="event.stopPropagation(); addToVocab('${pureWord}')">å˜èªå¸³ã«è¿½åŠ </button></span></span>`;
    }
    return word;
}

function speak(text) {
    const uttr = new SpeechSynthesisUtterance(text);
    uttr.lang = 'en-US'; uttr.rate = 0.8;
    speechSynthesis.speak(uttr);
}

function addToVocab(word) {
    const list = document.getElementById("my-vocab");
    if (list.innerHTML.includes(word)) return;
    const li = document.createElement("li");
    li.innerHTML = `<strong>${word}</strong><br><small>${DICT[word]}</small>`;
    list.appendChild(li);
}

function changeStep(mode) {
    currentMode = mode; isChallenging = false;
    clearInterval(timerInterval);
    document.getElementById("timer").textContent = "00:00";
    document.getElementById("pool-fixed").style.display = "none";
    document.getElementById("start-btn").style.display = "block";
    document.querySelectorAll(".step-btn").forEach(btn => btn.classList.remove("active"));
    document.getElementById("btn-" + mode).classList.add("active");
    render();
}

function render() {
    const area = document.getElementById("display-area");
    if(currentMode === 'info') {
        area.innerHTML = `
            <div class="section">
                <h2>1. ã€Œä¸‰å˜ç¾ã®sã€ã¨ã¯ï¼Ÿ</h2>
                <div class="rule-card">
                    ã€Œå½¼ã¯ã‹ã£ã“ã„ã„ã­ã€ã¨è©±ã‚’ã—ã¦ã„ãŸã¨ã—ã¾ã™ã€‚ãã“ã«ã¯ï¼Œå½¼ã¨ç§ã¨ã‚‚ã†1äººã®èãæ‰‹ã®3äººãŒã„ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ã“ã®ã‚ˆã†ãªã€Œå½¼ã€ã€Œå½¼å¥³ã€ã€Œãã‚Œã€ãªã©ã‚’ï¼Œä¸‰äººç§°å˜æ•°ã¨ã„ã„ã¾ã™ã€‚<br>
                    è‹±èªã®å ´åˆï¼Œä¸»èªãŒä¸‰äººç§°å˜æ•°ï¼ˆæ³¨ï¼šä¸‰äººç§°è¤‡æ•°ã€Œå½¼ã‚‰ã€ã€Œå½¼å¥³ã‚‰ã€ã€Œãã‚Œã‚‰ã€ã§ã¯ãªã„ï¼‰ã®ã¨ãï¼Œä¸€èˆ¬å‹•è©ã«ã¯ <strong>s</strong> ã‹ <strong>es</strong> ã‚’ã¤ã‘ã‚‹ç¿’æ…£ãŒã‚ã‚Šã¾ã™ã€‚
                </div>
                <h3>ä¸»èªã®åˆ¤åˆ¥è¡¨</h3>
                <table>
                    <tr><th>ã‚°ãƒ«ãƒ¼ãƒ—</th><th>ä¸»èªã®ä¾‹</th><th>å‹•è©ã®å½¢</th></tr>
                    <tr><td>ä¸€äººç§° (â‘ è‡ªåˆ†ã‚’ãµãã‚€)</td><td>I (ç§), We (ç§ãŸã¡)</td><td>ãã®ã¾ã¾</td></tr>
                    <tr><td>äºŒäººç§° (â‘¡ç›¸æ‰‹ã‚’ãµãã‚€)</td><td>You</td><td>ãã®ã¾ã¾</td></tr>
                    <tr><td>ä¸‰äººç§°ãƒ»è¤‡æ•° (â‘ â‘¡ä»¥å¤–)</td><td>They (å½¼ã‚‰), Tom and Ken</td><td>ãã®ã¾ã¾</td></tr>
                    <tr style="color:red; font-weight:bold;"><td>ä¸‰äººç§°ãƒ»å˜æ•° (â‘ â‘¡ä»¥å¤–) â˜…</td><td>He, She, It, Tom, My mother</td><td>s / es ã‚’ã¤ã‘ã‚‹</td></tr>
                </table>

                <h3 style="margin-top:20px;">äººç§°ã¨å˜æ•°ãƒ»è¤‡æ•°ã®ä¾‹</h3>
                <table>
                    <tr><th>äººç§°</th><th>å˜æ•°ãƒ»è¤‡æ•°</th><th>ã€ä¾‹ã€‘</th><th>äººç§°ã¨ã¯ï¼Ÿ</th></tr>
                    <tr><td rowspan="2">ä¸€äººç§°</td><td>å˜æ•°</td><td>I ç§ã¯</td><td rowspan="2">è‡ªåˆ†ã‚’å«ã‚€</td></tr>
                    <tr><td>è¤‡æ•°</td><td>we ç§ãŸã¡ã¯</td></tr>
                    <tr><td rowspan="2">äºŒäººç§°</td><td>å˜æ•°</td><td>you ã‚ãªãŸã¯</td><td rowspan="2">ã‚ãªãŸã‚’å«ã‚€</td></tr>
                    <tr><td>è¤‡æ•°</td><td>you ã‚ãªãŸãŸã¡ã¯</td></tr>
                    <tr style="background:#ffff00; font-weight:bold;">
                        <td rowspan="2">ä¸‰äººç§°</td><td>å˜æ•°</td><td>Heå½¼ Sheå½¼å¥³ Tomãƒˆãƒ  My fatherç§ã®çˆ¶</td><td rowspan="2">ãã‚Œä»¥å¤–</td></tr>
                    <tr><td>è¤‡æ•°</td><td>they å½¼ã‚‰ã¯</td></tr>
                </table>
            </div>

            <div class="section">
                <h2>2. å¤‰åŒ–ã®ãƒ«ãƒ¼ãƒ«ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã‚ˆã†</h2>
                <div class="example-intro">
                    ä¸‰äººç§°å˜æ•°ä¸»èªã§ç¾åœ¨å½¢ã®å ´åˆä¸€èˆ¬å‹•è©ã«ã¯s,esã‚’ä»˜ã‘ã¾ã™ã€‚<br>
                    ã€ä¾‹ã€‘He ã€ cleans ã€‘ his room .å½¼ã¯éƒ¨å±‹ã‚’æƒé™¤ã—ã¾ã™ã€‚
                </div>
                <table>
                    <tr><th style="width:20%">å…ƒã®å½¢</th><th style="width:30%">ä¸‰å˜ç¾ã®å½¢</th><th>ãƒ«ãƒ¼ãƒ«</th></tr>
                    <tr><td>play</td><td><span class="blank" data-ans="plays">plays</span><span class="ruby ruby-text">ãƒ—ãƒ¬ã‚¤ã‚º</span></td><td>ç›´æ¥ s ã‚’ã¤ã‘ã‚‹</td></tr>
                    <tr><td>go</td><td><span class="blank" data-ans="goes">goes</span><span class="ruby ruby-text">ã‚´ã‚¦ã‚º</span></td><td>o, s, x, ch, sh ã§çµ‚ã‚ã‚Œã° es</td></tr>
                    <tr><td>study</td><td><span class="blank" data-ans="studies">studies</span><span class="ruby ruby-text">ã‚¹ã‚¿ãƒ‡ã‚£ãƒ¼ã‚º</span></td><td>å­éŸ³(aiueoä»¥å¤–)+yã‚’iã«å¤‰ãˆã¦ es</td></tr>
                    <tr><td>have</td><td><span class="blank" data-ans="has">has</span><span class="ruby ruby-text">ãƒã‚º</span></td><td>ã€ä¸è¦å‰‡ã€‘å½¢ãŒå®Œå…¨ã«å¤‰ã‚ã‚‹</td></tr>
                </table>
                <div class="task-box">
                    <strong>ã€ç¢ºèªå•é¡Œã€‘ä¸‰å˜ç¾ã®å½¢ã«ç›´ã—ãªã•ã„ã€‚</strong><br>
                    (1) like(å¥½ã) â†’ <span class="blank" data-ans="likes">likes</span><span class="ruby ruby-text">ãƒ©ã‚¤ã‚¯ã‚¹</span><br>
                    (2) speak(è©±ã™) â†’ <span class="blank" data-ans="speaks">speaks</span><span class="ruby ruby-text">ã‚¹ãƒ”ãƒ¼ã‚¯ã‚¹</span><br>
                    (3) watch(è¦‹ã‚‹) â†’ <span class="blank" data-ans="watches">watches</span><span class="ruby ruby-text">ã‚¦ã‚©ãƒƒãƒã‚º</span> <span class="hint-text">â€»o,s,x,ch,shã§çµ‚ã‚ã‚‹ä¸€èˆ¬å‹•è©ãªã®ã§esã‚’ä»˜ã‘ã¾ã™ã€‚</span><br>
                    (4) wash(æ´—ã†) â†’ <span class="blank" data-ans="washes">washes</span><span class="ruby ruby-text">ã‚¦ã‚©ã‚·ãƒ¼ã‚º</span> <span class="hint-text">â€»o,s,x,ch,shã§çµ‚ã‚ã‚‹ä¸€èˆ¬å‹•è©ãªã®ã§esã‚’ä»˜ã‘ã¾ã™ã€‚</span><br>
                    (5) use(ã¤ã‹ã†) â†’ <span class="blank" data-ans="uses">uses</span><span class="ruby ruby-text">ãƒ¦ãƒ¼ã‚¸ã‚£ã‚º</span><br>
                    (6) teach(æ•™ãˆã‚‹) â†’ <span class="blank" data-ans="teaches">teaches</span><span class="ruby ruby-text">ãƒ†ã‚£ãƒ¼ãƒã‚º</span> <span class="hint-text">â€»o,s,x,ch,shã§çµ‚ã‚ã‚‹ä¸€èˆ¬å‹•è©ãªã®ã§esã‚’ä»˜ã‘ã¾ã™ã€‚</span><br>
                    (7) study(å‹‰å¼·ã™ã‚‹) â†’ <span class="blank" data-ans="studies">studies</span><span class="ruby ruby-text">ã‚¹ã‚¿ãƒ‡ã‚£ãƒ¼ã‚º</span> <span class="hint-text">â€»å­éŸ³ï¼‹yã®ä¸€èˆ¬å‹•è©ã®å ´åˆyã‚’iã«å¤‰ãˆã¦esã‚’ä»˜ã‘ã¾ã™ã€‚</span><br>
                    (8) try(ã‚„ã£ã¦ã¿ã‚‹) â†’ <span class="blank" data-ans="tries">tries</span><span class="ruby ruby-text">ãƒˆãƒ©ã‚¤ã‚º</span> <span class="hint-text">â€»å­éŸ³ï¼‹yã®ä¸€èˆ¬å‹•è©ã®å ´åˆyã‚’iã«å¤‰ãˆã¦esã‚’ä»˜ã‘ã¾ã™ã€‚</span><br>
                    (9) fly(é£›ã¶) â†’ <span class="blank" data-ans="flies">flies</span><span class="ruby ruby-text">ãƒ•ãƒ©ã‚¤ã‚º</span> <span class="hint-text">â€»å­éŸ³ï¼‹yã®ä¸€èˆ¬å‹•è©ã®å ´åˆyã‚’iã«å¤‰ãˆã¦esã‚’ä»˜ã‘ã¾ã™ã€‚</span>
                </div>
            </div>

            <div class="section">
                <h2>3. å¦å®šæ–‡ãƒ»ç–‘å•æ–‡ã®ä½œã‚Šæ–¹</h2>
                <div class="blue-card">
                    å¦å®šæ–‡ã§ã¯ <strong>åŠ©å‹•è©doesn'tãƒ€ã‚ºãƒ³ãƒˆ(does ãƒ€ã‚ºnotãƒãƒƒãƒˆã®çŸ­ç¸®å½¢)</strong>ã€ç–‘å•æ–‡ã§ã¯ <strong>Doesãƒ€ã‚ºåŠ©å‹•è©</strong> ã‚’ä½¿ã„ã€å‹•è©ã¯ <strong>å…ƒã®å½¢</strong> ã«æˆ»ã—ã¾ã™ã€‚<br>
                    <strong>é‡è¦ï¼šdoes(ã‚ºåŠ©å‹•è©)ä½¿ã£ãŸã‚‰ã€å‹•è©ã® s ã¯å–ã£ã¦ã€Œå…ƒã®å½¢ã€ã«æˆ»ã™ï¼</strong>
                </div>
                <div class="task-box">
                    <strong>ã€ç¢ºèªå•é¡Œã€‘( )å†…ã®æŒ‡ç¤ºã«å¾“ã£ã¦æ›¸ãæ›ãˆãªã•ã„ã€‚</strong><br>
                    <div class="q-item">
                        <span class="jp-text">1. Ken plays ${wrapWord("soccer")}. (å¦å®šæ–‡ã«ï¼šã‚±ãƒ³ã¯ã‚µãƒƒã‚«ãƒ¼ã‚’ã—ã¾ã›ã‚“ã€‚)</span>
                        â†’ Ken <span class="blank" data-ans="doesn't">doesn't</span> <span class="blank" data-ans="play">play</span> soccer. <button class="voice-btn" onclick="speak('Ken doesn\'t play soccer.')">ğŸ”Š</button>
                    </div>
                    <div class="q-item">
                        <span class="jp-text">2. She likes ${wrapWord("tennis")}. (ç–‘å•æ–‡ã«ï¼šå½¼å¥³ã¯ãƒ†ãƒ‹ã‚¹ãŒå¥½ãã§ã™ã‹ï¼Ÿ)</span>
                        â†’ <span class="blank" data-ans="Does">Does</span> she <span class="blank" data-ans="like">like</span> tennis? <button class="voice-btn" onclick="speak('Does she like tennis?')">ğŸ”Š</button>
                    </div>
                    <div class="q-item">
                        <span class="jp-text">3. Tom studies ${wrapWord("math")}. (ç–‘å•æ–‡ã«ï¼šãƒˆãƒ ã¯æ•°å­¦ã‚’å‹‰å¼·ã—ã¾ã™ã‹ï¼Ÿ)</span>
                        â†’ <span class="blank" data-ans="Does">Does</span> Tom <span class="blank" data-ans="study">study</span> math? <button class="voice-btn" onclick="speak('Does Tom study math?')">ğŸ”Š</button>
                    </div>
                    <div class="q-item">
                        <span class="jp-text">4. Does he speak English? (ã¯ã„ã§ç­”ãˆã‚‹ï¼šã¯ã„ã€å½¼ã¯è©±ã—ã¾ã™ã€‚)</span>
                        â†’ Yes, he <span class="blank" data-ans="does">does</span>. <button class="voice-btn" onclick="speak('Yes, he does.')">ğŸ”Š</button>
                    </div>
                    <div class="q-item">
                        <span class="jp-text">5. My father uses a ${wrapWord("computer")}. (å¦å®šæ–‡ã«ï¼šç§ã®çˆ¶ã¯ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚’ä½¿ã„ã¾ã›ã‚“ã€‚)</span>
                        â†’ My father <span class="blank" data-ans="doesn't">doesn't</span> <span class="blank" data-ans="use">use</span> a computer. <button class="voice-btn" onclick="speak('My father doesn\'t use a computer.')">ğŸ”Š</button>
                    </div>
                    <div class="q-item">
                        <span class="jp-text">6. Does she teach music? (ã„ã„ãˆã§ç­”ãˆã‚‹ï¼šã„ã„ãˆã€å½¼å¥³ã¯æ•™ãˆã¾ã›ã‚“ã€‚)</span>
                        â†’ No, she <span class="blank" data-ans="doesn't">doesn't</span>. <button class="voice-btn" onclick="speak('No, she doesn\'t.')">ğŸ”Š</button>
                    </div>
                    <div class="q-item">
                        <span class="jp-text">7. Tom studies ${wrapWord("Japanese")} ${wrapWord("every")} ${wrapWord("day")}. (å¦å®šæ–‡ã«ï¼šãƒˆãƒ ã¯æ¯æ—¥æ—¥æœ¬èªã‚’å‹‰å¼·ã—ã¾ã›ã‚“ã€‚)</span>
                        â†’ Tom <span class="blank" data-ans="doesn't">doesn't</span> <span class="blank" data-ans="study">study</span> Japanese every day. <button class="voice-btn" onclick="speak('Tom doesn\'t study Japanese every day.')">ğŸ”Š</button>
                        <span style="color:red; font-size:0.85rem; display:block;">â€»Tomã®ç¹°ã‚Šè¿”ã—ã‚’ã•ã‘ã¦ç­”ãˆã‚‹ã¨ãã¯ he ã‚’ä½¿ã„ã¾ã™ã€‚</span>
                    </div>
                    <div class="q-item">
                        <span class="jp-text">8. Does Mary play the piano? (ã„ã„ãˆã§ç­”ãˆã‚‹ï¼šã„ã„ãˆã€ãƒ¡ã‚¢ãƒªãƒ¼ï¼ˆå½¼å¥³ï¼‰ã¯å¼¾ãã¾ã›ã‚“ã€‚)</span>
                        â†’ No, she <span class="blank" data-ans="doesn't">doesn't</span>. <button class="voice-btn" onclick="speak('No, she doesn\'t.')">ğŸ”Š</button>
                        <span style="color:red; font-size:0.85rem; display:block;">â€»Maryã®ç¹°ã‚Šè¿”ã—ã‚’ã•ã‘ã¦ç­”ãˆã«ã¯ she ã‚’ä½¿ã„ã¾ã™ã€‚</span>
                    </div>
                </div>
            </div>`;
        
        document.querySelectorAll(".blank").forEach(el => {
            el.onclick = function() { handleTargetClick(this); };
        });

        if(!isChallenging) {
            document.querySelectorAll(".blank").forEach(el => el.textContent = el.dataset.ans);
            document.querySelectorAll(".ruby-text").forEach(el => el.classList.remove("hidden-ruby"));
            document.querySelectorAll(".hint-text").forEach(el => el.classList.remove("hidden-hint"));
        }
    } else {
        let modeTitle = currentMode === 'ex' ? 'ä¾‹é¡Œ' : currentMode === 'prac' ? 'é¡é¡Œ' : 'ä¿®äº†ãƒ†ã‚¹ãƒˆ';
        let html = `<div class="section"><h2>${modeTitle}æ¼”ç¿’ (å„6å•)</h2>`;
        MASTER_DATA[currentMode].forEach(q => {
            const voiceSent = q.en.join(" ").replace(" ? ", "? ") + q.mark;
            html += `<p style="margin-top:20px; font-weight:bold;">${q.jp}<button class="voice-btn" onclick="speak('${voiceSent}')">ğŸ”Š</button></p>
                     <div>
                        ${q.en.map(w => {
                            if (w === "?") return `<span class="fixed-mark">?</span><span class="line-break"></span>`;
                            if (w === ".") return `<span class="fixed-mark">.</span>`;
                            return `<span class="square" data-ans="${w}" onclick="handleTargetClick(this)">${isChallenging ? '' : wrapWord(w)}</span>`;
                        }).join("")}
                        <span class="fixed-mark">${q.mark}</span>
                     </div>`;
        });
        area.innerHTML = html + "</div>";
    }
}

function startChallenge() {
    isChallenging = true; render();
    if(currentMode === 'info') {
        document.querySelectorAll(".blank").forEach(el => { el.textContent = ""; el.classList.add("is-active"); });
        document.querySelectorAll(".ruby-text").forEach(el => el.classList.add("hidden-ruby"));
        document.querySelectorAll(".hint-text").forEach(el => el.classList.add("hidden-hint"));
    }
    document.getElementById("pool-fixed").style.display = "block";
    document.getElementById("start-btn").style.display = "none";
    renderPool();
    startTime = Date.now();
    timerInterval = setInterval(() => {
        const d = Math.floor((Date.now()-startTime)/1000);
        document.getElementById("timer").textContent = String(Math.floor(d/60)).padStart(2,'0')+":"+String(d%60).padStart(2,'0');
    }, 100);
}

function renderPool() {
    const pool = document.getElementById("word-pool"); pool.innerHTML = "";
    let words = [];
    if(currentMode === 'info') {
        document.querySelectorAll(".blank").forEach(el => words.push(el.dataset.ans));
    } else {
        MASTER_DATA[currentMode].forEach(q => {
            q.en.forEach(w => {
                if (w !== "?" && w !== ".") words.push(w);
            });
        });
    }

    words.sort((a, b) => a.toLowerCase().replace(/[^a-z]/g, '').localeCompare(b.toLowerCase().replace(/[^a-z]/g, '')));

    words.forEach((w, i) => {
        const card = document.createElement("div");
        card.className = "word-card"; card.id = "c-" + i; card.textContent = w;
        card.onclick = () => {
            selectedWord = w; selectedId = card.id;
            document.querySelectorAll(".word-card").forEach(c => c.classList.remove("selected"));
            card.classList.add("selected");
        };
        pool.appendChild(card);
    });
}

function handleTargetClick(el) {
    if (!isChallenging || !selectedWord || el.textContent !== "") return;
    if (selectedWord === el.dataset.ans) {
        el.textContent = selectedWord; el.classList.remove("is-active");
        document.getElementById(selectedId).classList.add("hidden");
        selectedWord = null;
        if([...document.querySelectorAll(".blank, .square")].every(s => s.textContent !== "")) {
            clearInterval(timerInterval); alert("ç´ æ™´ã‚‰ã—ã„ï¼åˆæ ¼ã§ã™ã€‚"); finishStep();
        }
    } else { alert("ä¸æ­£è§£ï¼ãƒ«ãƒ¼ãƒ«ã‚’æ€ã„å‡ºã—ã¦ã€‚"); }
}

function finishStep() {
    document.getElementById("btn-" + currentMode).classList.add("completed");
    const finalTime = document.getElementById("timer").textContent;
    document.getElementById("rec-0").textContent = finalTime;
    isChallenging = false; document.getElementById("start-btn").style.display = "block";
}
</script>
</body>
</html>